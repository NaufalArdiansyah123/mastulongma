<?php

namespace App\Livewire\Admin\Verifications;

use Livewire\Component;
use Livewire\WithPagination;
use Livewire\Attributes\Layout;
use App\Models\Registration;

#[Layout('layouts.admin')]
class Index extends Component
{
    use WithPagination;

    public $perPage = 10;
    public $showModal = false;
    public $selected = null;

    public function viewKtp($id)
    {
        $this->selected = Registration::find($id);
        if (!$this->selected) {
            session()->flash('message', 'Data tidak ditemukan.');
            return;
        }
        $this->showModal = true;
    }

    public function closeModal()
    {
        $this->selected = null;
        $this->showModal = false;
    }

    public function approveKtp($id)
    {
        $reg = Registration::find($id);
        if (!$reg) {
            session()->flash('message', 'Registrasi tidak ditemukan');
            return;
        }
        $reg->update(['status' => 'approved']);
        session()->flash('message', 'Registrasi disetujui.');
        $this->closeModal();
    }

    public function rejectKtp($id)
    {
        $reg = Registration::find($id);
        if (!$reg) {
            session()->flash('message', 'Registrasi tidak ditemukan');
            return;
        }
        $reg->update(['status' => 'rejected']);
        session()->flash('message', 'Registrasi ditolak.');
        $this->closeModal();
    }

    public function render()
    {
        $verifications = Registration::latest()->paginate($this->perPage);
        return view('admin.verifications', compact('verifications'));
    }
}
<?php

// Backup of original Index.php Livewire component

namespace App\Livewire\Admin\Verifications;

use Livewire\Component;
use Livewire\WithPagination;
use Livewire\Attributes\Layout;
use App\Models\Registration;

#[Layout('layouts.admin')]
class Index extends Component
{
    use WithPagination;

    public $perPage = 10;
    public $showModal = false;
    public $selected = null;

    public function viewKtp($id)
    {
        $this->selected = Registration::find($id);
        if (!$this->selected) {
            session()->flash('message', 'Data tidak ditemukan.');
            return;
        }
        $this->showModal = true;
    }

    public function closeModal()
    {
        $this->selected = null;
        $this->showModal = false;
    }

    public function approveKtp($id)
    {
        $reg = Registration::find($id);
        if (!$reg) {
            session()->flash('message', 'Registrasi tidak ditemukan');
            return;
        }
        $reg->update(['status' => 'approved']);
        session()->flash('message', 'Registrasi disetujui.');
        $this->closeModal();
    }

    public function rejectKtp($id)
    {
        $reg = Registration::find($id);
        if (!$reg) {
            session()->flash('message', 'Registrasi tidak ditemukan');
            return;
        }
        $reg->update(['status' => 'rejected']);
        session()->flash('message', 'Registrasi ditolak.');
        $this->closeModal();
    }

    public function render()
    {
        $verifications = Registration::latest()->paginate($this->perPage);
        return view('admin.verifications', compact('verifications'));
    }
}
